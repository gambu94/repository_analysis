<!DOCTYPE html>
<html lang="en-EN">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v3.8.6">
  <title>Repository Analiysis</title>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://kit.fontawesome.com/7f0344b895.js" crossorigin="anonymous"></script>

  <style > i.fas { color : white } </style>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="#">G.S.G. Project</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active" >
          <a class="nav-link" href="#repository-analysis">Repository Info</a>
        </li>
        <li class="nav-item" >
          <a class="nav-link" href="#results-list">Results List</a>
        </li>
      </ul>

<!--
      <form class="form-inline mt-2 mt-md-0">
        <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>
-->

    </div>
  </nav>
  <hr id="repository-analysis" class="pt-5">
  <main role="main" class="container mt-3">
    
    <h2>Repository Info</h2>
    
    <div class="alert alert-warning" role="alert">
      This is still a beta version!
    </div>

    <div>
      <div class="custom-control custom-radio custom-control-inline">
          <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input" checked>
          <label class="custom-control-label" for="customRadioInline1">Github.com</label>
        </div>
        <div class="custom-control custom-radio custom-control-inline">
          <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input" disabled>
          <label class="custom-control-label" for="customRadioInline2">Gitlab.com</label>
        </div>
        <div class="custom-control custom-radio custom-control-inline">
          <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input" disabled>
          <label class="custom-control-label" for="customRadioInline2">Others</label>
        </div>
    </div>


    <!-- TAB LIST -->

    <div class="row mt-3">
      <div class="col-md-12">
        <nav>
          <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-hotspot-tab" data-toggle="tab" href="#nav-hotspot" role="tab" aria-controls="nav-home" aria-selected="true">Hotspot</a>
            <a class="nav-item nav-link" id="nav-change-coupling-tab" data-toggle="tab" href="#nav-change-coupling" role="tab" aria-controls="nav-profile" aria-selected="false">Change-coupling</a>
            <a class="nav-item nav-link" id="nav-skill-tab" data-toggle="tab" href="#nav-skill" role="tab" aria-controls="nav-contact" aria-selected="false">Skill-analysis</a>
          </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="nav-hotspot" role="tabpanel" >
            <div class="mt-3">
              <h3>Hotspot Analysis</h3>
              <p >
                What Hotspot-analysis consists of:
                <blockquote>
                  The goal of Hotspot Analysis is to identify which are the most complex files that are often changed at the same time;
                  these files are called hotspots and need to be improved first.
                  File complexity is verified by cyclomatic complexity (WMC metric) and the number of lines code for each file.
                  The number of changes for a file is carried out by checking how many commits that file has received.
                </blockquote>
              </p>
              <form id="form-hotspot" name="form-hotspot" action="hotspot" class="needs-validation" novalidate>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="username-h">Username</label>
                    <input id="username-h" name="username" type="text" class="form-control" placeholder="" value="" required>
                    <div class="invalid-feedback">Valid username is required.</div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="repositoryName-h">Repository name</label>
                    <input id="repositoryName-h" name="repositoryName" type="text" class="form-control" placeholder="" value="" required>
                    <div class="invalid-feedback">Valid repository name is required.</div>
                  </div>
                </div>
                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="submit">Perform hotspot-analysis</button>
              </form>
            </div>
          </div>
          <div class="tab-pane fade" id="nav-change-coupling" role="tabpanel">
            <div class="mt-3">
              <h3>Change-coupling Analysis</h3>
              <p>
                What change-coupling analysis consists of:
                <blockquote>
                  The goal of Change coupling is to identify the pairs of files that change
                  together within a project. When a file is modified and often another one
                  is also changed, then probably these two files are coupled.
                </blockquote>
              </p>
              <form id="form-change" name="form-change" action="change-coupling" class="needs-validation" novalidate>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="username-c">Username</label>
                    <input id="username-c" name="username" type="text" class="form-control" placeholder="" value="" required>
                    <div class="invalid-feedback">Valid username is required.</div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="repositoryName-c">Repository name</label>
                    <input id="repositoryName-c" name="repositoryName" type="text" class="form-control" placeholder="" value="" required>
                    <div class="invalid-feedback">Valid repository name is required.</div>
                  </div>
                </div>
                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="submit">Perform change_coupling-analysis</button>
              </form>
            </div>
          </div>
          <div class="tab-pane fade" id="nav-skill" role="tabpanel" >
            <div class="mt-3" >
              <h3>Skill analysis</h3>
              <p>
                What skill-analysis consists of:
                <blockquote>
                  The goal of Skill Analysis is to create a developer skills profile, analyzing how many times that developer has used those Api in relation to those technologies, in all its GitHub repositories.

In the interface it is possible to remove the insignificant imports by inserting them as inputs separated by commas.
                </blockquote>
              </p>
              <form id="form-skill" name="form-change" action="skill-analysis" class="needs-validation" method="GET" novalidate>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="username-s">Username</label>
                    <input id="username-s" name="username" type="text" class="form-control" placeholder="" value="" required>
                    <div class="invalid-feedback">Valid username is required.</div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="country">Language</label>
                    <select id="language" class="custom-select d-block w-100" required>
                      <option value="">Choose...</option>
                      <option value="java">Java</option>
                      <option value="python" disabled>Python</option>
                    </select>
                    <div class="invalid-feedback">Please select one of the supported languages.</div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 mb-3">
                    <label for="package-to-filter">Package to filter</label>
                    <input id="package-to-filter" name="packages" type="text" class="form-control" placeholder="" value="java.io,java.utils" required>
                    <div class="invalid-feedback">Add package names separated by comma.</div>
                  </div>
                </div>
                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="submit">Perform skill-analysis</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <hr id="results-list" class="pt-5">
    <h2>Results List</h2>
    <div class="pb-5" >
      <ul class="list-group">
        {% for user in results %}
        <li class="list-group-item">username: <b>{{user['username']}}</b></li>
        <li class="list-group-item">
          <ul class="list-group">
            {% if user['skill-analysis'] %}
            <li class="list-group-item list-group-item-success ">skill-analysis
              <span class="float-right">
                <div class="btn-group" role="group" aria-label="Basic example">
                  <a class="btn btn-primary" href="{{url_for('show_skill', user = user['username'] )}}"><i class="fas fa-eye"></i></a>
                  <a class="btn btn-secondary" href="{{url_for('static',filename=user['skill-analysis']['path']) }}" download><i class="fas fa-file-download"></i></a>
                </div>
              </span>
            </li>
            {% endif %}
            {% if len( user['repos'] ) > 0 %}
            <li class="list-group-item">Repositories</li>
            <li class="list-group-item">
              <ul class="list-group">
              {% for repo in user['repos'] %}
                <li class="list-group-item">repo: <b>{{ repo }}</b></li>
                {% if 'hotspot-analysis' in user[repo] %}
                <li class="list-group-item list-group-item-success">hotspot-analysis
                  <span class="float-right">
                    <div class="btn-group" role="group" aria-label="Basic example">
                      <a class="btn btn-primary" href="{{url_for('show_hotspot', user = user['username'], repo = repo )}}"><i class="fas fa-eye"></i></a>
                      <a class="btn btn-secondary" href="{{url_for('static',filename=user[repo]['hotspot-analysis']['path']) }}" download><i class="fas fa-file-download"></i></a>
                    </div>
                  </span>
                </li>
                {% endif %}
                {% if 'change-coupling' in user[repo] %}
                <li class="list-group-item list-group-item-success">change-coupling
                  <span class="float-right">
                    <div class="btn-group" role="group" aria-label="Basic example">
                      <a class="btn btn-primary" href="{{url_for('show_change', user = user['username'], repo = repo )}}"><i class="fas fa-eye"></i></a>
                      <a class="btn btn-secondary" href="{{url_for('static',filename=user[repo]['change-coupling']['path']) }}" download><i class="fas fa-file-download"></i></a>
                    </div>
                  </span>
                </li>
                {% endif %}
              {% endfor %}
              </ul>
            </li>
            {% endif %}
          </ul>
        </li>
        {% endfor %}
      </ul>
    </div>
    <!-- END TAB LIST -->
  </main>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>

    <script>
      $(function(){
        String.prototype.format = function () {
          var i = 0, args = arguments;
          return this.replace(/{}/g, function () {
            return typeof args[i] != 'undefined' ? args[i++] : '';
          });
        };
        var adr = 'http://localhost'
        var url = ''
        $('form').submit(function(e){
          e.preventDefault();
          let service = $(this).attr('action')
          let form = $(this).serializeArray()
          if ( service == 'hotspot' ) {
            let username = form[0].value || 'default'
            let reponame = form[1].value || 'default'
            url = '{}:5001/api/{}/{}/{}'.format(adr,service,username,reponame)
          }
          if ( service == 'change-coupling' ) {
            let username = form[0].value || 'default'
            let reponame = form[1].value || 'default'
            url = '{}:5002/api/{}/{}/{}'.format(adr,service,username,reponame)
          }
          if ( service == 'skill-analysis' ) {
            let username = form[0].value || 'default'
            let packages = form[1].value || ''
            url = '{}:5003/api/{}/{}/?packages={}'.format(adr,service,username,packages)
          }
          alert("Analisi in corso. Troverai il risultato nella apposita sezione.");
          $.get(
            url,
            (r,status) => {
              alert("Analisi Completata.");
              console.log(r)
              resp = JSON.parse(r)
              console.log(typeof(resp))
              let purl = window.location.href
              window.location.replace(purl+'#results-list');
            }
          )
        })
      }) 
    </script>
</body>

</html>